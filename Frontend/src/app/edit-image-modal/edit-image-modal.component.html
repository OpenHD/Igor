<!-- edit-image-modal.component.html -->
<div class="modal-header">
  <h4 class="modal-title">{{ image?.id ? 'Edit Image' : 'New Image' }}</h4>
  <button type="button" class="btn-close" (click)="modal.dismiss()"></button>
</div>

<div class="modal-body">
  <form [formGroup]="imageForm" (ngSubmit)="onSubmit()">
    <div class="row g-3">
      <!-- Left Column -->
      <div class="col-md-6">
        <div class="mb-3">
          <label for="imageName" class="form-label">Name *</label>
          <input type="text" id="imageName" class="form-control"
                 formControlName="name" required>
          <div *ngIf="imageForm.get('name')?.invalid && imageForm.get('name')?.touched"
               class="text-danger small">
            Name is required
          </div>
        </div>

        <div class="mb-3">
          <label for="imageDescription" class="form-label">Description *</label>
          <textarea id="imageDescription" class="form-control"
                    formControlName="description" required rows="3"></textarea>
          <div *ngIf="imageForm.get('description')?.invalid && imageForm.get('description')?.touched"
               class="text-danger small">
            Description is required
          </div>
        </div>

        <div class="mb-3">
          <label for="imageIcon" class="form-label">Icon URL *</label>
          <input type="url" id="imageIcon" class="form-control"
                 formControlName="icon" required
                 (input)="updateIconPreview()">
          <div class="mt-2">
            <img [src]="iconPreview" alt="Icon preview"
                 class="img-thumbnail"
                 style="max-width: 100px; height: auto"
                 *ngIf="iconPreview">
          </div>
          <div *ngIf="imageForm.get('icon')?.invalid && imageForm.get('icon')?.touched"
               class="text-danger small">
            Valid URL required
          </div>
        </div>

        <div class="mb-3">
          <label class="form-label">URLs</label>
          <div formArrayName="urls">
            <div *ngFor="let urlGroup of urls.controls; let i = index" [formGroupName]="i">
              <input type="url"
                     formControlName="url"
                     class="form-control"
                     placeholder="Image URL">
              <button type="button"
                      class="btn btn-outline-secondary"
                      (click)="setDefaultUrl(i)">
                <i class="bi"
                   [class.bi-star-fill]="urlGroup.get('isDefault')?.value"
                   [class.bi-star]="!urlGroup.get('isDefault')?.value"></i>
              </button>
              <button type="button"
                      class="btn btn-outline-danger"
                      (click)="removeUrl(i)">
                <i class="bi bi-trash"></i>
              </button>
            </div>
          </div>
          <button type="button"
                  class="btn btn-sm btn-secondary"
                  (click)="addUrl()">
            <i class="bi bi-plus"></i> Add URL
          </button>
        </div>
      </div>

      <!-- Right Column -->
      <div class="col-md-6">
        <div class="mb-3">
          <label for="imageCategory" class="form-label">Category *</label>
          <select id="imageCategory" class="form-select" formControlName="categoryId">
            <option *ngFor="let cat of categories" [value]="cat.id">
              {{ cat.name }}
            </option>
          </select>>
        </div>
        <div class="mb-3">
          <label for="extractSize" class="form-label">Extract Size (bytes) *</label>
          <input type="number" id="extractSize" class="form-control" formControlName="extractSize" required min="0">
        </div>
        <div class="mb-3">
          <label for="extractSha256" class="form-label">SHA256 Hash *</label>
          <input type="text" id="extractSha256" class="form-control" formControlName="extractSha256" required>
        </div>
        <div class="mb-3">
          <label for="imageDownloadSize" class="form-label">Download Size (bytes) *</label>
          <input type="number" id="imageDownloadSize" class="form-control" formControlName="imageDownloadSize" required min="0">
        </div>
        <div class="mb-3 form-check">
          <input type="checkbox" id="imageEnabled" class="form-check-input" formControlName="isEnabled">
          <label for="imageEnabled" class="form-check-label">Enabled</label>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-secondary" (click)="modal.dismiss()">Cancel</button>
      <button type="submit" class="btn btn-primary">Save</button>
    </div>
  </form>
</div>
