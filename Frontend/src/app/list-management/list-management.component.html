<div class="container mt-4">
  <div class="card shadow">
    <!-- Header -->
    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
      <h4 class="mb-0">Image Lists</h4>
      <button class="btn btn-light btn-sm" (click)="focusNewListInput()">
        <i class="bi bi-plus-lg"></i> New List
      </button>
    </div>

    <div class="card-body">
      <!-- Loading & Error States -->
      <div *ngIf="loading" class="alert alert-info">
        <i class="bi bi-arrow-repeat me-2"></i> Loading image lists...
      </div>
      <div *ngIf="error" class="alert alert-danger alert-dismissible fade show">
        {{ error }}
        <button type="button" class="btn-close" (click)="error = null"></button>
      </div>

      <!-- Neuer Listeneintrag -->
      <div class="mb-3" *ngIf="!loading && !error">
        <form (ngSubmit)="createList()">
          <div class="row g-2 align-items-center">
            <div class="col-md-3">
              <input #newListInput type="text" class="form-control" placeholder="List Name"
                     [(ngModel)]="newList.name" name="name" required>
            </div>
            <div class="col-md-3">
              <input type="text" class="form-control" placeholder="Endpoint"
                     [(ngModel)]="newList.endpoint" name="endpoint">
            </div>
            <div class="col-md-3">
              <input type="text" class="form-control" placeholder="Latest Version"
                     [(ngModel)]="newList.latestVersion" name="latestVersion">
            </div>
            <div class="col-md-3">
              <input type="text" class="form-control" placeholder="URL"
                     [(ngModel)]="newList.url" name="url">
            </div>
            <div class="col-md-12 mt-2">
              <textarea class="form-control" placeholder="Description"
                        [(ngModel)]="newList.description" name="description"></textarea>
            </div>
            <div class="col-md-2">
              <button class="btn btn-success w-100 mt-2" type="submit" [disabled]="!newList.name?.trim()">
                <i class="bi bi-plus-circle me-2"></i> Add New
              </button>
            </div>
          </div>
        </form>
      </div>

      <!-- Liste der Image Lists -->
      <ul class="list-group">
        <li class="list-group-item" *ngFor="let list of imageLists; trackBy: trackById">
          <!-- Anzeige vs. Bearbeitung -->
          <div *ngIf="!list.isEditing; else editTemplate" (click)="startEditing(list)" style="cursor: pointer;">
            <h5 class="mb-1">{{ list.name }}</h5>
            <p class="mb-0 small text-muted">{{ list.description || 'No description provided' }}</p>
            <p class="mb-0 small"><strong>Endpoint:</strong> {{ list.endpoint }}</p>
            <p class="mb-0 small"><strong>Latest Version:</strong> {{ list.latestVersion }}</p>
            <p class="mb-0 small"><strong>URL:</strong> {{ list.url }}</p>
          </div>

          <!-- Bearbeitungs-Template -->
          <ng-template #editTemplate>
            <div class="w-100">
              <div class="mb-2">
                <label class="form-label small">List Name</label>
                <input type="text" class="form-control" [(ngModel)]="list.editedName">
              </div>
              <div class="mb-2">
                <label class="form-label small">Endpoint</label>
                <input type="text" class="form-control" [(ngModel)]="list.editedEndpoint">
              </div>
              <div class="mb-2">
                <label class="form-label small">Latest Version</label>
                <input type="text" class="form-control" [(ngModel)]="list.editedLatestVersion">
              </div>
              <div class="mb-2">
                <label class="form-label small">URL</label>
                <input type="text" class="form-control" [(ngModel)]="list.editedUrl">
              </div>
              <div class="mb-2">
                <label class="form-label small">Description</label>
                <textarea class="form-control" [(ngModel)]="list.editedDescription"></textarea>
              </div>
            </div>
          </ng-template>

          <!-- Aktion-Buttons -->
          <div class="btn-group mt-2">
            <button *ngIf="list.isEditing" class="btn btn-sm btn-outline-success" (click)="saveList(list)">
              <i class="bi bi-check-lg"></i>
            </button>
            <button *ngIf="list.isEditing" class="btn btn-sm btn-outline-secondary" (click)="cancelEditing(list)">
              <i class="bi bi-x-lg"></i>
            </button>
            <button class="btn btn-sm btn-outline-danger" (click)="deleteList(list.id)">
              <i class="bi bi-trash"></i>
            </button>
          </div>
        </li>
      </ul>
    </div>
  </div>
</div>
