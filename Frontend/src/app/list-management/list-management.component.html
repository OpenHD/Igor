<!-- Modern OpenHD List Management -->
<div class="page-container">
  <div class="page-header">
    <h1><i class="bi bi-collection me-3"></i>OS Image Lists</h1>
    <div class="page-actions">
      <button class="btn-primary-modern" (click)="toggleNewListForm(); $event.stopPropagation()">
        <i class="bi bi-plus-lg"></i>
        <span>New List</span>
      </button>
    </div>
  </div>

  <!-- Loading & Error States -->
  @if (isLoading$ | async) {
    <div class="modern-card">
      <div class="loading-state">
        <i class="bi bi-arrow-repeat spinning me-2"></i>
        <span>Loading OS image lists...</span>
      </div>
    </div>
  }

  @if (error) {
    <div class="modern-card error-card">
      <div class="error-message">
        <i class="bi bi-exclamation-triangle"></i>
        {{ error }}
        <button class="btn-secondary-modern btn-sm" (click)="error = null">
          <i class="bi bi-x"></i>
        </button>
      </div>
    </div>
  }

  <!-- New List Form -->
  @if (isCreatingNewList) {
    <div class="modern-card mb-4">
      <div class="card-header">
        <h3><i class="bi bi-plus-circle me-2"></i>Create New OS Image List</h3>
      </div>
      <form (ngSubmit)="createList()" class="list-form">
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label-modern">
              <i class="bi bi-tag me-2"></i>List Name <span class="required">*</span>
            </label>
            <input #newListInput
              type="text"
              class="form-control-modern"
              placeholder="Enter list name"
              [(ngModel)]="newList.name"
              name="name"
              required>
          </div>
          <div class="form-group">
            <label class="form-label-modern">
              <i class="bi bi-link-45deg me-2"></i>API Endpoint
            </label>
            <div class="input-group-modern">
              <span class="input-prefix">/image_list/</span>
              <input type="text"
                class="form-control-modern"
                placeholder="endpoint-name"
                [(ngModel)]="newList.endpoint"
                name="endpoint">
            </div>
          </div>
          <div class="form-group">
            <label class="form-label-modern">
              <i class="bi bi-layers me-2"></i>Latest Version
            </label>
            <input type="text"
              class="form-control-modern"
              placeholder="e.g. 1.0.0"
              [(ngModel)]="newList.latestVersion"
              name="latestVersion">
          </div>
          <div class="form-group">
            <label class="form-label-modern">
              <i class="bi bi-box-arrow-up-right me-2"></i>Image Writer URL
            </label>
            <input type="url"
              class="form-control-modern"
              placeholder="https://example.com/docs"
              [(ngModel)]="newList.url"
              name="url">
          </div>
          <div class="form-group full-width">
            <label class="form-label-modern">
              <i class="bi bi-text-paragraph me-2"></i>Description
            </label>
            <textarea class="form-control-modern"
              rows="3"
              placeholder="Add a brief description..."
              [(ngModel)]="newList.description"
              name="description"></textarea>
          </div>
        </div>
        <div class="form-actions">
          <button type="button" class="btn-secondary-modern" (click)="toggleNewListForm()">
            <i class="bi bi-x me-2"></i>Cancel
          </button>
          <button type="submit" class="btn-primary-modern" [disabled]="!newList.name?.trim()">
            <i class="bi bi-plus-circle me-2"></i>Create List
          </button>
        </div>
      </form>
    </div>
  }

  <!-- All Lists Display -->
  @if (imageLists.length > 0) {
    <div class="modern-card">
      <div class="card-header">
        <div class="d-flex align-items-center gap-2">
          <h3><i class="bi bi-grid-3x3-gap me-2"></i>Your OS Image Lists</h3>
          <span class="status-badge status-active">{{ imageLists.length }}</span>
        </div>
      </div>
      
      <div class="lists-container">
        @for (list of imageLists; track trackById($index, list)) {
          <div class="list-card" [class.editing]="list.isEditing">
            @if (!list.isEditing) {
              <!-- Display Mode -->
              <div class="list-header">
                <div class="list-info">
                  <h4><i class="bi bi-collection me-2"></i>{{ list.name }}</h4>
                  @if (list.description) {
                    <p class="list-description">{{ list.description }}</p>
                  }
                </div>
                <div class="list-actions">
                  <button class="btn-secondary-modern btn-sm" (click)="startEditing(list)" title="Edit">
                    <i class="bi bi-pencil"></i>
                  </button>
                  <button class="btn-danger-modern btn-sm" (click)="confirmDelete(list)" title="Delete">
                    <i class="bi bi-trash"></i>
                  </button>
                </div>
              </div>
              
              <div class="list-details">
                <div class="detail-item">
                  <div class="detail-label">
                    <i class="bi bi-link-45deg me-2"></i>API Endpoint
                  </div>
                  <div class="detail-value">
                    <code>/image_list/{{ list.endpoint || 'not-set' }}</code>
                  </div>
                </div>
                <div class="detail-item">
                  <div class="detail-label">
                    <i class="bi bi-layers me-2"></i>Latest Version
                  </div>
                  <div class="detail-value">
                    {{ list.latestVersion || 'No version specified' }}
                  </div>
                </div>
                <div class="detail-item">
                  <div class="detail-label">
                    <i class="bi bi-box-arrow-up-right me-2"></i>Image Writer
                  </div>
                  <div class="detail-value">
                    @if (list.url) {
                      <a [href]="list.url" target="_blank" class="external-link">
                        {{ list.url }}
                        <i class="bi bi-box-arrow-up-right ms-2"></i>
                      </a>
                    } @else {
                      <span class="text-muted">No Image Writer URL</span>
                    }
                  </div>
                </div>
              </div>
            } @else {
              <!-- Edit Mode - Expandable -->
              <div class="list-header edit-mode">
                <h4><i class="bi bi-pencil me-2"></i>Edit List</h4>
                <div class="edit-actions">
                  <button type="button" class="btn-secondary-modern btn-sm" (click)="cancelEditing(list)">
                    <i class="bi bi-x"></i>
                  </button>
                </div>
              </div>
              <form (ngSubmit)="saveList(list)" class="edit-form">
                <div class="edit-grid">
                  <div class="edit-row">
                    <div class="form-group">
                      <label class="form-label-compact">
                        <i class="bi bi-tag me-1"></i>Name
                      </label>
                      <input type="text"
                        class="form-control-compact"
                        [(ngModel)]="list.editedName"
                        name="editedName"
                        required>
                    </div>
                    <div class="form-group">
                      <label class="form-label-compact">
                        <i class="bi bi-layers me-1"></i>Version
                      </label>
                      <input type="text"
                        class="form-control-compact"
                        [(ngModel)]="list.editedLatestVersion"
                        name="editedLatestVersion"
                        placeholder="1.0.0">
                    </div>
                  </div>
                  
                  <div class="edit-row">
                    <div class="form-group">
                      <label class="form-label-compact">
                        <i class="bi bi-link-45deg me-1"></i>Endpoint
                      </label>
                      <div class="input-group-compact">
                        <span class="input-prefix-compact">/image_list/</span>
                        <input type="text"
                          class="form-control-compact"
                          [(ngModel)]="list.editedEndpoint"
                          name="editedEndpoint"
                          placeholder="endpoint">
                      </div>
                    </div>
                  </div>
                  
                  <div class="edit-row">
                    <div class="form-group full-width">
                      <label class="form-label-compact">
                        <i class="bi bi-box-arrow-up-right me-1"></i>Image Writer URL
                      </label>
                      <input type="url"
                        class="form-control-compact"
                        [(ngModel)]="list.editedUrl"
                        name="editedUrl"
                        placeholder="https://example.com/docs">
                    </div>
                  </div>
                  
                  <div class="edit-row">
                    <div class="form-group full-width">
                      <label class="form-label-compact">
                        <i class="bi bi-text-paragraph me-1"></i>Description
                      </label>
                      <textarea class="form-control-compact"
                        rows="2"
                        [(ngModel)]="list.editedDescription"
                        name="editedDescription"
                        placeholder="Brief description..."></textarea>
                    </div>
                  </div>
                </div>
                
                <div class="edit-footer">
                  <button type="submit" class="btn-primary-modern btn-sm">
                    <i class="bi bi-check-lg me-1"></i>Save
                  </button>
                  <button type="button" class="btn-secondary-modern btn-sm" (click)="cancelEditing(list)">
                    <i class="bi bi-x me-1"></i>Cancel
                  </button>
                </div>
              </form>
            }
          </div>
        }
      </div>
    </div>
  }
</div>

<!-- Delete Confirmation Modal -->
<ng-template #deleteModal let-modal>
  <div class="modern-modal">
    <div class="modal-header">
      <h5 class="modal-title">
        <i class="bi bi-exclamation-triangle me-2 text-danger"></i>
        Confirm Deletion
      </h5>
      <button type="button" class="btn-close" (click)="modal.dismiss()"></button>
    </div>
    <div class="modal-body">
      <p>Are you sure you want to delete the list <strong>"{{ selectedList?.name }}"</strong>?</p>
      <div class="alert alert-warning">
        <i class="bi bi-info-circle me-2"></i>
        This action cannot be undone.
      </div>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn-secondary-modern" (click)="modal.dismiss()">
        <i class="bi bi-x me-2"></i>Cancel
      </button>
      <button type="button" class="btn-danger-modern" (click)="deleteList(selectedList?.id); modal.close()">
        <i class="bi bi-trash me-2"></i>Delete List
      </button>
    </div>
  </div>
</ng-template>